# Task-a-Log

A simple system to log (lack of) completion of complex tasks in a software system.

## The problem

In a microservices architecture, some components emit a message that should cause the execution of certain tasks in
other components. This may happen directly, using an API call, others may be conveyd by asynchronous systems, such as
message queues.

The completion of a task composed of multiple sub-tasks distributed on different microservices can be hard, whether
each subtask can be executed in parallel or should execute in a particular order.

**Task-a-Log** purpose is to centralize the logging of complex tasks, or, more specifically, log and quickly notify
when a task has not completed in time.

## Configuration

### The tasks

A task is a complex process that is made of multiple steps.
Tasks are defined in the `etc/tasks` directory.

A task is made of:

* `id`: the ID of the task. **note**: the filename should be `[id].yml`

* `max_duration_seconds`: the maximum number of seconds since the start of the task before the whole task is considered
not on schedule, or too late

* `ordered`:  true if the sub-tasks should execute in order to be valid

* `steps`: the steps (or sub-tasks) comprising the task

Each task is made of:

* `id`: the ID of the step

* `status`: the starting status of the step

* `expected_status`: the status that is expected to consider the step successfully executed


### The timers

A timer is an event that is expected to happen within a certain time period.
Timers are defined in the `etc/timers` directory.

A timer starts when the first request is performed to it. 

A timer is made of:

* `id`: the ID of the timer. **note**: the filename should be `[id].yml`

* `within_seconds`: the period length in seconds

### The notifiers

You may want to activate notifications to trigger when a condition is not met.

To activate a notificator, edit the `notificator` list in the `etc/application.yml` file.

Currently we support a rudimentary email notificator. E-mail settings can be confiured in the `mail_notification.yml`
file.
 
 
### Results

Results are logged in the `results` directory.

## Interactions

Currently the only communication protocol available to communicate an event to Task-A-Log is HTTP calls to an API.

* `POST /worklog/submit`: to submit an task event. The body is made of:
    * `id`: the ID of the **transaction** which needs to be shared by all submissions generated by the same event
    * `task_id`: the task ID
    * `step_id`: the ID of the step
    * `sender_id`: the ID of the sender
    * `status`: the status of the step
    
    Example:
    ```text
    {
    	"id": "17185",
    	"task_id": "Scheduler",
    	"step_id": "executed",
    	"sender_id": "AFScheduler",
    	"status": "DONE"
    }
    ```
* `POST /timer/submit`: to submit a timer event. The body is made of:
    * `id`: The ID of the timer
    ```text
    {
    	"id":"EmailTimer"
    }
    ```